<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>AppleOfMyIframe tests</title>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.js"></script>
  <!-- 
      <script src="http://code.jquery.com/nightlies/jquery-nightly.js"></script>
  -->
  <script src="appleofmyiframe.js"></script>
  <style>
    button {
        font-size:1.6em;
        padding:0.16em;
        display:block;
        margin:0 0.38em 0.38em 0;
    }
    .stealth {
        position: absolute;
        overflow:hidden;
        width:1px;
        height:1px;
        top:0;
        left:0;
    }
    #tests, #browser, #append-method {
        float:left;
        margin:0 6.85em 2.62em 0;
        padding-bottom:2.62em;
        border-bottom:1px solid #ccc;
    }
    #append-method {
        display:none;
    }
    #tests .desc {
        font-size:1.6em;
    }
    .stage {
        float:left;
        width:38.2%;
        padding:1.62em;
        margin-right:1.62em;
        border:1px solid #ccc;
    }
    #stage1 {
        clear:both;
        color:#336;
        background-color:#fff;
        border-color:#336;
    }
    #stage2 {
        background-color:#336;
        color:#ccf;
        border-color:#ccf;
    }
    iframe {
        display:block;
        margin:1.62em !important;
        border:1px solid #336 !important;
    }
  </style>
</head>

<body>
  <h1>AppleOfMyIframe</h1>
  
  <div id="tests">
      <h2>Tests</h2>  
      <p class="desc">Do the iframes and their contents stay intact throughout?</p>
      <div id="controls">
        <ol>
            <li>
                <button id="move-iframes">Move iframes to a new DOM node</button>
            </li>
            <li>
                <button id="reload-page">Reload host window</button>
            </li>
        </ol>
      </div>
  </div>
  
  <div id="append-method" class="report">
    <h2>Append method</h2>
    <p class="report"></p>
  </div>
  
  <div id="browser" class="report">
    <h2>Your browser</h2>
    <textarea class="user-agent" rows="3" cols="42"></textarea>
  </div>
  
  <div id="stage1" class="stage">
    <h2>Over here</h2>
  </div>
  <div id="stage2" class="stage">
    <h2>Over there</h2>
  </div>
  
  <script>
  // Console logger
  // http://github.com/premasagar/console
  var
  _ = (function(){
	    var
	        win = window,
	        ua = win.navigator.userAgent,
	        console = win.console,
	        opera = win.opera,
	        debug;
	    
        // Doesn't support console API
	    if (!console){
	        // Opera 
	        return (opera && opera.postError) ?
                 function(){
                     var i, argLen, log = opera.postError, args = arguments;
                     argLen = args.length;
		             for (i=0; i < argLen; i++){
			             log(args[i]);
		             }
                 } :
                 function(){};
	    }
	    // Temporary for WebKit, while its console has a bug in calling debug directly or log.apply
	    else if (/webkit/i.test(ua)){	    
            return function(){
                var i, argLen, args = arguments;
                argLen = args.length;
		        for (i=0; i < argLen; i++){
			        console.log(args[i]);
		        }
            };
        }
        else {
	        debug = console.debug;
	        return debug ? // FF Firebug
		        debug :
		        function(){
			        var i, argLen, log = console.log, args = arguments;
			        if (log){ // WebKit
				        if (typeof log.apply === 'function'){
					        log.apply(console, args);
				        }
				        else { // IE8
					        argLen = args.length;
					        for (i=0; i < argLen; i++){
						        log(args[i]);
					        }
				        }
			        }
		        };
		}
    })();
    
    // ****************************************
    
    // AOMI TESTS
  
(function(){
    var
        win = window,
        iframes = win.i = [],
        counter = 0
    win.i = [];
    count = 0;;

    $('#browser .user-agent')
    .val(window.navigator.userAgent)
    .focus(function(){
        var textarea = this;
        window.setTimeout(function(){
            textarea.select();
        });
    });

/*
    // Determine appendMethod
    var stealth = $('<div></div>')
        .addClass('stealth')
        .appendTo('body');
    var iHidden = $.iframe('<p>blah</p>', {attr:{id:'iHidden'}})
        .one('restore', function(ev, appendMethod){
            $('#append-method')
                .show()
                .find('.report')
                    .text(appendMethod);
            stealth.remove();
            delete stealth;
            delete iHidden;
        })
        .load(function(){
            this.appendTo(stealth);
        })
        .appendTo(stealth);
 */
        
  
    $('button#move-iframes')
        .toggle(
            function(){
                $.each(window.i, function(){
                    this.appendTo('#stage2');
                });
            },
            function(){
                $.each(window.i, function(){
                    this.appendTo('#stage1');
                });
            }
        );

    $('button#reload-page')
        .click(function(){
            window.location.href = window.location.href;
        });

    
    window.i.push(
        // External src iframes
        $.iframe('http://javascript.crockford.com/code.html')
            .attr('id', 'i' + count++)
            .appendTo('#stage1'),
            
        
        $.iframe('http://google.it')
            .attr('id', 'i' + count++)
            .appendTo('#stage1'),
            
            
        // Injected iframes
        $.iframe(
            '<p>An injected iframe. No body background color is set on the iframe - it is left transparent. Text in the iframe document has styling, including a background color.</p>',
            function(){
                this
                    .css({padding:'2.62em'})
                    .style('p {background-color:#336; color:#ccf; font-size:1.6em;}');
            }
        )
            .attr('id', 'i' + count++)
            .appendTo('#stage1'),
            
        
        $.iframe(
            '<p>An injected iframe. A background color set on the iframe, but no styles are set on the iframe\' document contents.</p>',
            {
                attr:{
                    id:'i' + count++
                },
                css:{
                    backgroundColor:'#ccf',
                    padding:'2.62em',
                    margin:'1.62em 1.62em 2.62em 0',
                    color:'#336'
                }
            }
        )
            .appendTo('#stage1')
    );
	
	 
	/*
    // Example usage
    // Return a new iframe element, in an enhanced jQuery wrapper
    $.iframe();
    
    // Grab the iframe's body element, in a jQuery wrapper
    $.iframe().body();
    
    // Inject content into the iframe body. The following all achieve the same.
    $.iframe('<p>blah</p>');
    $.iframe().body('<p>blah</p>');
    $.iframe().body().append('<p>blah</p>');
    
    // The above examples are not visible on the page, because they do not add the iframe to the DOM. This example does:
    $.iframe('<p>blah</p>')
      .appendTo('body')
      .append('<p>stuff</p>');
    
    // Grab an existing element in the DOM and inject it into a new iframe; then replace the element with that iframe
		$('#example-host-content').intoIframe();
    
    // Resize iframe element to fit its body contents
    $.iframe('<p>blah2</p>').matchSize()
      .appendTo('body');
	*/
})();
  </script>
</body>
</html>
